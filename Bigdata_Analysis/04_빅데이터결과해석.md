# 4. 빅데이터 결과 해석
## 1. 분석 모형 평가 및 개선
#### 회귀모형 평가지표
**1. 평가 지표**
- 평균 절대 오차(MAE : Mean Absolute Error) : 실제 값과 예측 값의 차이(오차)에 절댓값을 취해 평균한 값. 직관적이나 에러의 크기가 그대로 반영됨
- 평균 제곱 오차(MSE : Mean Squared Error) : 모형의 실제 값과 예측 값의 차이를 제곱하여 평균한 값
- 평균제곱근오차(RMSE : Root Mean Squared Error) : MSE에 제곱근을 씌운 값. MSE는 실 오류의 평균보다 값이 더 커지는 경향이 있어 MSE에 제곱근을 씌운 형태를 사용함
- 평균절대백분율오차(MAPE : Mean Absolute Percentage Error) : MAE를 퍼센트로 변환한 값. 오차를 비율로 나타내어 단위가 다른 변수 간에 오차를 비교할 수 있음

**2. 결정계수(Coefficient of determination, R^2)**
- 선형 회귀 모형이 실제 데이터를 얼마나 잘 설명하는지를 나타내는 지표. 결정계수 값이 1에 가까울수록 모형의 설명력이 높다.
- SST(Total Sum of Squares) : 전체제곱합. 실제 관측치와 y값들의 평균의 차이를 제곱하여 합한 값
- SSR(Regression Sum of Squares) : 회귀제곱합. 모형의 예측치와 y값들의 평균의 차이를 제곱하여 합한 값
- SSE(Error Sum of Squares) : 오차제곱합. 실제 관측치와 모형의 예측치의 차이를 제곱하여 합한 값

#### 분류 모형 평가 지표 - 기출
**1. 혼동 행렬(Confusion Matrix)**
- 분류모형이 예측한 값과 실제 값의 조합을 표 형태로 나타낸 것. 예측 값과 실제 값의 참/거짓 조합에 따라 **TP, FN, FP, TN** 네 가지로 구분한다.

**2. 평가 지표**
- 혼동행렬을 구한 후 아래의 다양한 평가 지표를 계산할 수 있다.
- **정확도(Accuracy)** : 전체 데이터 중 예측을 정확하게 한 데이터의 비율
- **정밀도(Precision)** : Positive로 예측한 데이터 중 실제 Positive인 데이터의 비율
- **재현율, 민감도(Recall, Sensitivity)** : 실제 Positive인 데이터 중 모형이 Positive로 예측한 데이터의 비율
- **특이도(Specificity)** : 실제 Negative인 데이터 중 모형이 Negative로 예측한 데이터의 비율
  - 거짓 긍정률(FPR) = 1-특이도
- **F-1 Score** : 정밀도와 재현율의 조화평균
- **거짓 긍정률(FPR, False Positive Rate)** : 실제 Negative인 데이터 중 모형이 Positive로 예측한 데이터의 비율
- **참 긍정률(TPR, True Positive Rate)** : 실제 Positive인 데이터 중 모형이 Positive로 예측한 데이터의 비율

**3. ROC 곡선(Receiver Operating Characteristic curve)**
- 임계값을 0에서 1까지 변화시켜 가면서 x축에는 거짓 긍정률, y축에는 참 긍정률을 표시해서 그린 곡선
- 임계값이 변화함에 따라 Positive/Negative 분류 여부가 달라지므로 ROC 곡선도 다르게 나타난다.


#### 분석 모형 진단
- **선형성** : 종속변수는 독립변수의 선형 함수다.
- **독립성** : 독립변수 사이에는 상관관계가 없어야 한다.
- **등분산성** : 오차항의 분산은 등분산이다.
- **정규성** : 오차항의 평균은 0이다.


#### 교차 검증
- **k-fold 교차 검증** : 데이터를 k개의 fold로 나누어 k-1개는 학습에, 나머지 한 개는 검증에 사용한다. 
- **홀드아웃 교차 검증** : 데이터를 무작위로 7:3 또는 8:2의 비율로 학습 데이터와 검증 데이터로 나누는 방법
- **리브-p-아웃 교차검증** : 데이터 중 p개의 관측치만 검증 데이터로 사용하고 나머지는 학습 데이터로 사용하는 방법


#### 모수 유의성 검정(Significance test)
- 수집된 자료가 통계적으로 유의한지 판단하는 과정. 수집된 자료의 모집단에 대해 가설을 설정하고 그 가설이 맞는지 확인한다. 그 가설이 모집단의 분포를 가정하는 것이면 모수 검정, 아니면 비모수 검정이라 한다.
- **모수 검정** : 모집단의 분포를 가정하고 표본의 평균, 표준 편차 등을 이용하여 집단 간 차이를 검정하는 방법
- **비모수 검정** : 모집단의 분포를 가정하지 않고 집단 간 차이를 검정하는 방법


#### 적합도 검정
**1. Q-Q plot**
- 관측치의 분포가 정규분포에 얼마나 가까운지 시각적으로 표현하는 데 사용. y축은 데이터를 표준화한 z값, x축은 표준정규분포에서의 해당 분위수를 말한다. Q-Q plot 위에 나타낸 데이터가 대각선 형태의 참조선에 가깝게 보이면 관측치의 분포가 정규분포에 가깝다 볼 수 있다.

**2. 카이제곱 검정(Chi - Squared Test) - 기출**
- 어떤 그룹이 서로 독립인지 아닌지 확인하는 방법. 카이제곱 검정은 목적에 따라 독립성 검정, 적합성 검정, 동일성 검정으로 나뉜다. 현재의 설명은 적합성 검정을 위주로 설명함
  - **적합성 검정** : 모집단의 분포가 내가 생각한 분포와 동일한가?
  - 독립성 검정 : 두 변수는 서로 독립적인가?
  - 동일성 검정 : 두 집단의 분포가 동일한가?
- 카이제곱 검정은 범주형 데이터에 사용되며 데이터가 예상되는 분포에 얼마나 잘 맞는지를 검정한다.

3. 샤피로 윌크 검정(Shapiro - Wilk Normality Test) : 데이터의 정규성을 검증하는 방법
4. 콜모고로프 스미로노프 검정 : 데이터가 예상되는 분포에 얼마나 잘 맞는지를 검정. 데이터의 누적분포함수와 예상 분포의 누적분포함수를 비교하기에 연속형 데이터에서 적용이 가능하다.


#### 과대 적합과 과소 적합
- **과대적합** : 분석 모형이 학습 데이터에 지나치게 적합하여 일반화되지 않는 것을 말함. 학습 데이터의 특성을 필요 이상으로 담은 복잡한 모형이 만들어졌다 생각할 수 있음
- 과대적합의 방지 : 학습 데이터 수 증가, 가중치 규제, 교차 검증 등의 방법을 통하여 이를 해결한다.
  - **학습 데이터 수 증가** : 충분한 양의 데이터를 학습하도록 기간을 늘리거나 오버 샘플링 기법을 사용한다.
  - **가중치 규제** : 가중치 값을 제한하여 변수의 수를 줄이는 효과를 낸다.
  - **교차 검증** : 검증 데이터를 매번 다르게 사용하기에 하나의 검증 데이터에 과대적합할 가능성을 낮춰준다.

#### 매개변수 최적화
- 분석 모형을 학습하는 것은 학습 데이터부터 손실함수의 값을 가장 작게 만드는 매개변수의 최적값을 찾아 나가는 과정이다.
- 손실함수 값은 구하기 복잡하고, 분석 모형의 매개변수 개수도 많아 매개변수의 최적값을 구하는 것은 어렵다.

**1. 경사하강법(Gradient descent)**
- 가중치 매개변수에 대한 손실함수의 기울기를 통해 최적값을 구하는 방법
- 매개변수 벡터에 대해 손실함수의 현재 기울기를 계산하고, 기울기가 감소하는 방향으로 매개변수 값을 갱신한다. 갱신을 반복하다 기울기가 0이 되는 순간이 손실함수가 최소화되는 매개변수 값이 된다.
- 현재는 확률적 경사하강법을 개선한 다양한 옵티마이저가 사용된다.(모멘텀, Adagrad, RMSProp 등)

2. 모멘텀(Momentum) : 확률적 경사하강법의 매개변수 변경 방향에 가속도를 부여해주는 방식
3. AdaGrad(Adaptive Gradient) : 매개변수 값을 업데이트하면서 각 변수마다 학습률이 다르게 적용하는 방법. 초깃값에서 이미 값이 많이 변한 매개변수는 최적값에 가까워졌다고 생각하고 학습률을 작게 하여 값을 미세하게 조절한다.
4. RMSProp :  AdaGrad에서 최적값에 도달하기 전에 학습률이 0에 가까워지는 상황을 방지하기 위하여 개선된 방법. 새로운 하이퍼파라미터 p를 도입하여 h에서 기울기를 더할 때 단순 누적이 아니라 지수가중이동평균값을 더한다.
5. Adam(Adaptive moment estimation) : 모멘텀과 RMSProp이 합쳐진 형태. 최근 가장 많이 사용되는 옵티마이저


#### 분석 모형 융합(=앙상블)
- 보팅 : 여러 개의 분석 모형 결과를 종합하는 방법.
  - **직접 투표(Hard Voting)** : 많이 선택된 클래스를 최종 결과로 예측하는 방법
  - **간접 투표(Soft Voting)** : 각 모형의 클래스 확률 값을 평균내어 확률이 가장 높은 클래스를 최종 결과로 예측하는 방법

- **배깅(Bagging)** : bootstrap aggregating의 줄임말. 학습 데이터에서 일정한 크기의 부트스트랩 **샘플을 무작위로 복원 추출.** 이를 이용해 분석 모형을 각각 학습한 후 학습한 결과를 종합하여 최종 분석 모형을 구한다. 대표 알고리즘으로 Random Forest가 있음
- **부스팅(Boosting)** : **약한 분석 모형을 여러 개 연결해서 강한 분석 모형을 만드는 방법.** 정답에는 낮은 가중치를, 오답에는 높은 가중치를 두어 오답을 더 잘 맞출 수 있도록 학습을 시킨다. 대표 알고리즘으로 Adaboost, XGBoost, LightBGM이 있음
- **스태킹(Stacking)** : **여러 분석 모형의 예측을 종합**하는 방식으로 모형을 사용함. 학습 데이터로 여러 개의 분석 모형을 만든 후 각 분석 모형의 예측값들을 독립변수로 하는 최종 예측 모형을 학습시킨다.

#### 최종 모형 선정
- 최종모형 평가 기준 선정 : 분석 모형 개발이 완료된 후 최종모형을 선정하기 위한 평가 기준을 정함. 정확도, 정밀도, 재현율 등 일반적으로 분석모형 평가에 사용하는 성능지표를 사용함
- 분석모형 평가 : 분석모형 최종 평가를 위해 훈련에 사용하지 않았던 데이터를 사용함
- 최종모형 선정 : 분석가, 비즈니스 업무 담당자, 데이터 처리자 등 관련 인원들이 함께 모여 분석모형 평가 결과를 놓고 최종모형을 선정함


#### 오답
- 이상치가 있는 데이터에서는 오차를 제곱하여 계산하는 지표보다 절댓값을 취하여 계산하는 지표가 더 유리하다.
- 과대적합은 분석 모형의 편향이 높고 분산이 낮은 상태이다. 
- AdaGrad(확률적 경사하강법)은 배치의 크기가 1인 배치 경사하강법으로 볼 수 없다.
- 데이터의 정규성을 판단하는 데 활용하는 지표로 히스토그램, Q-Q plot, 샤피로-윌크 검정을 통해 알아낼 수 있다. 카이제곱 검정으로는 알아낼 수 없음


## 2. 분석 결과 해석 및 활용
#### 해석 가능한 모형(Interpretable models)
- **선형 회귀/로지스틱 회귀 모형** : 각 변수의 가중치가 구해지므로 그 값을 참고할 수 있음
- **의사결정나무** : 각 분기점에서 사용된 기준을 참고함

#### 순열 변수 중요도
- 특정 변수를 사용하지 않았을 때 모형의 성능에 어느 정도의 손실을 주는지를 계산함으로 해당 변수의 중요도를 파악하는 방법
- 한 변수에 대해 그 변수의 값을 무작위로 섞어서 예측 값들을 구한다. 해당 변수의 값을 무작위로 사용함으로 부석 모형이 학습한 패턴을 지우는 효과를 주는 것임.
- 랜덤 포레스트 : importance 함수값을 True로 해주면 중요도 값을 지표화시킬 수 있다.

#### 부분 의존도 plot(PDP : Partial Dependence Plot)
- 의존도를 확인하고자 하는 변수를 한두 개 선택한 후 나머지 변수들에 대해서는 단순 평균을 취하여 해당 변수가 분석한 모형에서 어떤 영향을 미치는지 확인하는 방법
- 먼저 선택된 변수의 값을 하나로 고정시켜 놓고 학습 데이터의 다른 변수들의 값을 이용해서 결과 값의 평균을 구한다.


#### 비즈니스 기여도 평가 - 딱히
- 투자 대비 효과(ROI : Return On Investment) : 투자로 얻을 수 있는 순 효과를 총 비용으로 나눈 값
- 순현재가치(NPV : Net Present Value) : 투자 시작 시점부터 사업이 끝나는 시기까지 연도별로 편익과 비용을 현재 가치로 환산한 값
- 내부 수익률(IRR : Internal Rate of Return) : 순현재가치를 0으로 만드는 할인율
- 총 소유 비용(TCO : Total Cost of Ownership) : 자산을 획득할 때 드는 비용뿐 아니라 교육학습, 유지보수 등의 제반비용을 고려하여 산출되는 총 비용
- 투자 회수 기간(PP : Payback Period) : 프로젝트 시작에서부터 누적 현금흐름이 흑자로 돌아서는 시점까지의 기간


#### 시각화
- 목적
  - 데이터 분석 : 많은 양의 자료를 표, 그래프 형대로 정리하믕로 즉각적으로 데이터의 의미를 파악할 수 있게 함
  - 의사소통 : 데이터가 가지고 있는 의미와 인사이트를 다른 사람들과 공유할 수 있도록 하는 매개체가 됨
- 분류
  - 데이터 시각화 : 명확하고 효과적으로 정보를 전달하기 위함. 데이터들의 연결과 그룹핑을 표현
  - 정보 시각화 : 대규모 비수량 정보를 시각적으로 표현. 데이터 시각화보다 한 단계 더 가공과정 거침
  - 정보 디자인 : 사람이 사용할 수 있는 효과적인 정보와 복잡하고 구조적이지 않은 기술데이터를 시각적으로 표현


#### 시각화 프로세스
1. 정보 구조화 : 데이터를 수집하고 정제하면서 시각화의 목표가 될만한 것을 발견하거나 설정하는 단계
2. 정보 시각화 : 시각화 툴을 사용하여 시각화에 필요한 그래프나 기본 틀을 만드는 단계
3. 정보 시각표현 : 최종적으로 시각적인 완성을 하는 단계


#### 시간 시각화
- 시간에 따른 데이터의 변화를 보여주는 방법. 일반적으로 x축을 시간, y축을 데이터 값으로 하는 그래프 형태를 사용함
- 종류
  - 막대 그래프 : 범주별 데이터 값을 나타낼 때 사용함.
  - 산점도 : 관계를 알고 싶은 두 변수를 x축, y축으로 두고 관측치의 값에 해당하는 위치에 점으로 표시하는 시각화 방법
  - 선 그래프 : 관측치를 점으로 표시한 후, 점들을 선으로 이어서 표시함.
  - 계단식 그래프 : x축과 평행한 선으로 연결하여 마치 계단과 같이 그려짐
  - 영역 차트 : 선 그래프 안의 영역을 색으로 칠한 형태. 시간에 따른 값의 변화를 보여줌

#### 공간 시각화
- 데이터를 지도 위해 표현하는 방법. 지리 정보가 데이터를 이해하는 데 중요한 요소일 경우 주로 사용함
- 종류
  - 등치 지역도 : 지도 위에 시도 등 지리적 단위를 기준으로 데이터의 의미를 색상으로 구분해 나타내는 방법
  - 도트 플롯 맵 : 위도, 경도 값을 가지고 있는 데이터의 경우, 각 지리적 좌표 위에 점을 찍어 데이터를 나타내는 방법
  - 버블 플롯 맵 : 도트 플롯 맵과 같이 위도, 경도 값을 가지고 있는 데이터의 경우 각 지리적 좌표 위에 데이터를 표시하는 방법
  - 카토그램 : 데이터 값에 따라 지도상에서 지역의 크기를 조정하여 나타내는 방법
  - 등치선도 : 지도 위에 같은 지리적 위치를 가진 곳을 선으로 이어서 나타내는 방법

#### 관계 시각화 - 기출
- 변수 간에 존재하는 연관성이나 분포, 패턴을 찾기 위해 사용하는 방법
- 종류
  - **산점도(Scatter Plot)** : 산점도는 두 변수 사이의 관계를 확인할 때 유용하게 사용
  - **산점도 행렬(Scatter plot matrix)** : 다변량 데이터에서 모든 수치형 변수 간의 산점도를 그릴 때 사용하는 방법. 모든 수치형 변수 간의 관계를 하나하나 확인하기 힘들 때 산점도 행렬도 전반적인 관계를 확인할 수 있음
  - **버블차트(Bubble Chart)** - 기출 : 두 변수 사이의 관계를 나타내는 것은 산점도와 동일하나 점의 버블의 크기 혹은 모양을 통해 다른 변수를 나타낸다는 것이 차이점
  - **히스토그램(Histogram)** : 막대그래프와 유사한 형태로, 데이터의 도수 분포를 막대 형태로 시각화하여 보여주는 방법

#### 비교 시각화 - 부분 기출
- 종류
  - 히트맵 : 히트맵의 각 행은 관측치를, 열은 변수를 나타내고, 각 칸의 색상을 이용해 값의 크기를 나타냄. 관측치 수가 너무 많거나 변수의 개수가 너무 많은 경우 그래프를 해석하기에 어려움이 있음
  - **스타 차트(Star Chart) - 기출** : 수치형 변수 여러 개에 대해 각각을 축으로 두고 중앙으로부터의 거리로 값을 나타냄. 중앙이 변수의 최솟값, 축의 끝이 변수의 최댓값이 됨. 여러 관측치를 함께 나타낼 경우 데이터 간의 비교도 쉽게 할 수 있음
  - 체르노프 페이스 : 각 변수 값을 눈, 코, 입, 귀 등 얼글의 부분에 대응하여 표현하는 시각화 방법
  - 평행 좌표 그래프 : 나타내고자 하는 몇 개의 변수에 대해 각 변수를 y축에 평행한 여러 개의 축으로 두고 데이터를 표현하는 방법. 하나의 선은 하나의 데이터를 의미하며 각 선이 어떤 패턴을 보이는지 확인할 수 있음


#### 인포그래픽 - 기출
- 인포메이션과 그래픽을 합친 말. 복잡한 데이터를 그래픽으로 이해하기 쉽게 표현하는 시각화 방법
- 데이터 시각화와는 다르게 Raw Data를 취급하지 않으며, 다양한 정보를 종합하여 디자인 의도에 따라 그래픽으로 나타낸다.
- 목적
  - 정보형 메시지 : 객관적인 정보를 전달하는 형태(필요한 정보를 전달)
  - 설득형 메시지 : 주장하는 바를 전달하는 형태(사회적 메시지)


#### 분석 결과 활용
1. **분석 모형 전개** : 데이터를 분석한 결과를 확장 적용하기 위한 단계
2. **분석 결과 활용 시나리오 개발** : 분석 결과로부터 인사이트를 발굴하고 의사결정에 반영하는 방법을 검토 및 선택하는 방법을 담음
  - 인사이트 발굴 및 확장 : 분석주제를 정의할 때 처음에 계획한 분석 결과 활용 방안 외에 비즈니스 관점에서 얻을 수 있는 인사이트 발굴
  - 의사결정 방법 선택 : 인사이트를 업무에 언제, 어떻게 반영할 것인가를 검토
  - 차트 및 시각화 도구 선택 : 분석 결과에 적합한 차트 및 시각화 도구를 선택
3. **분석 모형 모니터링** : 분석 모형이 운영 시스템에 적용될 경우 매번 새로운 데이터로 추론을 수행하게 되므로 학습 때와 비슷한 성능을 내지 못할 수 있다. 따라서 분석 모형의 성능을 지속적으로 모니터링하면서 개선이 필요한 시점을 파악해야 함
  - 분석 모형 모니터링 주기 : 성능 지표의 변화 추이를 주별/월별/분기별 등 어떤 주기로 확인하고 싶은지에 따라 분석 모형 모니터링 주기를 설정함
  - 분석 모형 성능 측정 항목 : 운영 정보와 성능을 모니터링하기 위한 지표값, 상태 기준 값 등을 정의하고 관리함
  - 분석 모형 재학습 : 분석 모형이 운영 시스템에 적용된 후에도 학습은 지속적으로 이루어져야 함
4. **분석 모형 리모델링** : 모니터링 결과 분석 모형의 성능이 크게 떨어지거나 성능 저하가 지속되는 경우 분석 모형 리모델링을 수행한다.
  - 기존 모형 분석  : 기존 분석 모형의 성능 평가지표의 변화를 확인한다.
  - 데이터 수집 및 전처리 : 기존 분석 모형에 사용된 데이터를 확인하고 추가로 필요한 데이터가 있는지 검토하여 사용 데이터 종류 및 기간을 확정함
  - 분석 모형 구축 : 분석 모형 개발 단계와 동일하게 분석 모형을 구축함. 기존에 사용하지 않았떤 데이터를 사용하거나, 새로운 변수를 설계하거나, 새로운 알고리즘을 적용함.
  - 최종 분석 모형 선정 및 반영 : 분석 모형 구축 단계에서 만든 분석 모형 중 최종 분석 모형을 선정함